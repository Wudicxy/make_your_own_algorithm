<!-- templates/baguwen/base.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}程序员八股文{% endblock %}</title>
    <!-- Font Awesome 图标 -->
    {% load static %}
    <link rel="icon" href="{% static 'images/logo.svg' %}?v=3" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .question-card {
            margin-bottom: 20px;
        }

        .tag {
            background: #f8f9fa;
            padding: 2px 8px;
            margin: 2px;
            border-radius: 3px;
        }

        .difficulty-1 {
            color: #28a745;
        }

        .difficulty-2 {
            color: #ffc107;
        }

        .difficulty-3 {
            color: #fd7e14;
        }

        .difficulty-4 {
            color: #dc3545;
        }

        /* 下拉菜单样式 */
        .dropdown-menu {
            border: none;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }

        .dropdown-item:hover {
            background-color: #f8f9fa;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>


<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <!-- 在任何页面中添加返回按钮 -->
    <button onclick="goBack()" class="btn btn-secondary btn-back">
        <i class="fas fa-arrow-left"></i> 我的刷题系统
    </button>
    <div class="container">
        <a class="navbar-brand" href="{% url 'baguwen:question_list' %}">程序员八股文</a>

        <!-- 移动端切换按钮 -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- 导航菜单 -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'baguwen:question_list' %}">
                        <i class="fas fa-list"></i> 题目列表
                    </a>
                </li>

                <!-- 八股文下拉菜单 -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="baguwenDropdown" role="button"
                       data-bs-toggle="dropdown">
                        <i class="fas fa-book"></i> 八股文管理
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'baguwen:category_list' %}">
                            <i class="fas fa-th-list"></i> 分类浏览
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'baguwen:random_question' %}">
                            <i class="fas fa-random"></i> 随机题目
                        </a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="{% url 'baguwen:import_questions' %}">
                            <i class="fas fa-upload"></i> 题目导入
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'baguwen:quick_add' %}">
                            <i class="fas fa-plus"></i> 快速添加
                        </a></li>
                    </ul>
                </li>

                {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'baguwen:my_favorites' %}">
                            <i class="fas fa-heart text-danger"></i> 我的收藏
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                           data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i> {{ user.username }}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'baguwen:my_favorites' %}">
                                <i class="fas fa-star"></i> 我的收藏
                            </a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="/admin/" target="_blank">
                                <i class="fas fa-cog"></i> 管理后台
                            </a></li>
                        </ul>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="alert('请先登录')">
                            <i class="fas fa-heart-o"></i> 收藏
                        </a>
                    </li>
                {% endif %}

                <!-- 快速操作按钮 -->
                <li class="nav-item">
                    <a class="nav-link btn btn-outline-primary btn-sm ms-2" href="{% url 'baguwen:random_question' %}">
                        <i class="fas fa-dice"></i> 随机一题
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}

    {% block content %}{% endblock %}
</div>

<!-- Footer -->
<footer class="bg-dark text-light mt-5 py-4">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h6>程序员八股文系统</h6>
                <p class="small text-muted">专业的程序员面试题库管理系统</p>
            </div>
            <div class="col-md-6 text-end">
                <div class="small text-muted">
                    <a href="{% url 'baguwen:question_list' %}" class="text-light text-decoration-none">题目列表</a> |
                    <a href="{% url 'baguwen:category_list' %}" class="text-light text-decoration-none">分类浏览</a> |
                    <a href="{% url 'baguwen:import_questions' %}" class="text-light text-decoration-none">导入题目</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- 通用JavaScript功能 -->
<script>

    // 通用返回功能
    function goBack() {
        // 检查是否有历史记录
        if (document.referrer && document.referrer !== window.location.href) {
            // 如果来源页面是本站页面，则返回
            if (document.referrer.includes(window.location.host)) {
                window.history.back();
            } else {
                // 否则跳转到首页
                window.location.href = "{% url 'baguwen:question_list' %}";
            }
        } else {
            // 没有历史记录时跳转到首页
            window.location.href = "{% url 'baguwen:question_list' %}";
        }
    }

    // 键盘快捷键支持
    document.addEventListener('keydown', function (e) {
        // Alt + 左箭头 = 返回
        if (e.altKey && e.key === 'ArrowLeft') {
            e.preventDefault();
            goBack();
        }
        // Alt + R = 随机题目
        if (e.altKey && e.key === 'r') {
            e.preventDefault();
            window.location.href = "{% url 'baguwen:random_question' %}";
        }
    });

    // 通用的Toast提示功能
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 500px;';
        toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

        document.body.appendChild(toast);

        // 3秒后自动消失
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 3000);
    }

    // 页面加载完成后的初始化
    document.addEventListener('DOMContentLoaded', function () {
        // 激活当前页面的导航链接
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.navbar-nav .nav-link');

        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            }
        });

        // 添加页面加载动画
        document.body.style.opacity = '0';
        document.body.style.transition = 'opacity 0.3s ease-in-out';

        setTimeout(() => {
            document.body.style.opacity = '1';
        }, 100);

        // 显示键盘快捷键提示（仅首次访问）
        if (!localStorage.getItem('shortcutTipShown')) {
            setTimeout(() => {
                showToast('💡 提示：使用 Alt + ← 快速返回，Alt + R 随机题目', 'info');
                localStorage.setItem('shortcutTipShown', 'true');
            }, 2000);
        }
    });

    // 通用的Toast提示功能
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 500px;';
        toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

        document.body.appendChild(toast);

        // 3秒后自动消失
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 3000);
    }

    // 页面加载完成后的初始化
    document.addEventListener('DOMContentLoaded', function () {
        // 激活当前页面的导航链接
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.navbar-nav .nav-link');

        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            }
        });

        // 添加页面加载动画
        document.body.style.opacity = '0';
        document.body.style.transition = 'opacity 0.3s ease-in-out';

        setTimeout(() => {
            document.body.style.opacity = '1';
        }, 100);
    });
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
