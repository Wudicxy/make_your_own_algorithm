<!-- templates/baguwen/base.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ç¨‹åºå‘˜å…«è‚¡æ–‡{% endblock %}</title>
    <!-- Font Awesome å›¾æ ‡ -->
    {% load static %}
    <link rel="icon" href="{% static 'images/logo.svg' %}?v=3" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .question-card {
            margin-bottom: 20px;
        }

        .tag {
            background: #f8f9fa;
            padding: 2px 8px;
            margin: 2px;
            border-radius: 3px;
        }

        .difficulty-1 {
            color: #28a745;
        }

        .difficulty-2 {
            color: #ffc107;
        }

        .difficulty-3 {
            color: #fd7e14;
        }

        .difficulty-4 {
            color: #dc3545;
        }

        /* ä¸‹æ‹‰èœå•æ ·å¼ */
        .dropdown-menu {
            border: none;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }

        .dropdown-item:hover {
            background-color: #f8f9fa;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>


<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <!-- åœ¨ä»»ä½•é¡µé¢ä¸­æ·»åŠ è¿”å›æŒ‰é’® -->
    <button onclick="goBack()" class="btn btn-secondary btn-back">
        <i class="fas fa-arrow-left"></i> æˆ‘çš„åˆ·é¢˜ç³»ç»Ÿ
    </button>
    <div class="container">
        <a class="navbar-brand" href="{% url 'baguwen:question_list' %}">ç¨‹åºå‘˜å…«è‚¡æ–‡</a>

        <!-- ç§»åŠ¨ç«¯åˆ‡æ¢æŒ‰é’® -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- å¯¼èˆªèœå• -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'baguwen:question_list' %}">
                        <i class="fas fa-list"></i> é¢˜ç›®åˆ—è¡¨
                    </a>
                </li>

                <!-- å…«è‚¡æ–‡ä¸‹æ‹‰èœå• -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="baguwenDropdown" role="button"
                       data-bs-toggle="dropdown">
                        <i class="fas fa-book"></i> å…«è‚¡æ–‡ç®¡ç†
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'baguwen:category_list' %}">
                            <i class="fas fa-th-list"></i> åˆ†ç±»æµè§ˆ
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'baguwen:random_question' %}">
                            <i class="fas fa-random"></i> éšæœºé¢˜ç›®
                        </a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="{% url 'baguwen:import_questions' %}">
                            <i class="fas fa-upload"></i> é¢˜ç›®å¯¼å…¥
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'baguwen:quick_add' %}">
                            <i class="fas fa-plus"></i> å¿«é€Ÿæ·»åŠ 
                        </a></li>
                    </ul>
                </li>

                {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'baguwen:my_favorites' %}">
                            <i class="fas fa-heart text-danger"></i> æˆ‘çš„æ”¶è—
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                           data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i> {{ user.username }}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'baguwen:my_favorites' %}">
                                <i class="fas fa-star"></i> æˆ‘çš„æ”¶è—
                            </a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="/admin/" target="_blank">
                                <i class="fas fa-cog"></i> ç®¡ç†åå°
                            </a></li>
                        </ul>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="alert('è¯·å…ˆç™»å½•')">
                            <i class="fas fa-heart-o"></i> æ”¶è—
                        </a>
                    </li>
                {% endif %}

                <!-- å¿«é€Ÿæ“ä½œæŒ‰é’® -->
                <li class="nav-item">
                    <a class="nav-link btn btn-outline-primary btn-sm ms-2" href="{% url 'baguwen:random_question' %}">
                        <i class="fas fa-dice"></i> éšæœºä¸€é¢˜
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}

    {% block content %}{% endblock %}
</div>

<!-- Footer -->
<footer class="bg-dark text-light mt-5 py-4">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h6>ç¨‹åºå‘˜å…«è‚¡æ–‡ç³»ç»Ÿ</h6>
                <p class="small text-muted">ä¸“ä¸šçš„ç¨‹åºå‘˜é¢è¯•é¢˜åº“ç®¡ç†ç³»ç»Ÿ</p>
            </div>
            <div class="col-md-6 text-end">
                <div class="small text-muted">
                    <a href="{% url 'baguwen:question_list' %}" class="text-light text-decoration-none">é¢˜ç›®åˆ—è¡¨</a> |
                    <a href="{% url 'baguwen:category_list' %}" class="text-light text-decoration-none">åˆ†ç±»æµè§ˆ</a> |
                    <a href="{% url 'baguwen:import_questions' %}" class="text-light text-decoration-none">å¯¼å…¥é¢˜ç›®</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- é€šç”¨JavaScriptåŠŸèƒ½ -->
<script>

    // é€šç”¨è¿”å›åŠŸèƒ½
    function goBack() {
        // æ£€æŸ¥æ˜¯å¦æœ‰å†å²è®°å½•
        if (document.referrer && document.referrer !== window.location.href) {
            // å¦‚æœæ¥æºé¡µé¢æ˜¯æœ¬ç«™é¡µé¢ï¼Œåˆ™è¿”å›
            if (document.referrer.includes(window.location.host)) {
                window.history.back();
            } else {
                // å¦åˆ™è·³è½¬åˆ°é¦–é¡µ
                window.location.href = "{% url 'baguwen:question_list' %}";
            }
        } else {
            // æ²¡æœ‰å†å²è®°å½•æ—¶è·³è½¬åˆ°é¦–é¡µ
            window.location.href = "{% url 'baguwen:question_list' %}";
        }
    }

    // é”®ç›˜å¿«æ·é”®æ”¯æŒ
    document.addEventListener('keydown', function (e) {
        // Alt + å·¦ç®­å¤´ = è¿”å›
        if (e.altKey && e.key === 'ArrowLeft') {
            e.preventDefault();
            goBack();
        }
        // Alt + R = éšæœºé¢˜ç›®
        if (e.altKey && e.key === 'r') {
            e.preventDefault();
            window.location.href = "{% url 'baguwen:random_question' %}";
        }
    });

    // é€šç”¨çš„Toastæç¤ºåŠŸèƒ½
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 500px;';
        toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

        document.body.appendChild(toast);

        // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 3000);
    }

    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
        // æ¿€æ´»å½“å‰é¡µé¢çš„å¯¼èˆªé“¾æ¥
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.navbar-nav .nav-link');

        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            }
        });

        // æ·»åŠ é¡µé¢åŠ è½½åŠ¨ç”»
        document.body.style.opacity = '0';
        document.body.style.transition = 'opacity 0.3s ease-in-out';

        setTimeout(() => {
            document.body.style.opacity = '1';
        }, 100);

        // æ˜¾ç¤ºé”®ç›˜å¿«æ·é”®æç¤ºï¼ˆä»…é¦–æ¬¡è®¿é—®ï¼‰
        if (!localStorage.getItem('shortcutTipShown')) {
            setTimeout(() => {
                showToast('ğŸ’¡ æç¤ºï¼šä½¿ç”¨ Alt + â† å¿«é€Ÿè¿”å›ï¼ŒAlt + R éšæœºé¢˜ç›®', 'info');
                localStorage.setItem('shortcutTipShown', 'true');
            }, 2000);
        }
    });

    // é€šç”¨çš„Toastæç¤ºåŠŸèƒ½
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 500px;';
        toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

        document.body.appendChild(toast);

        // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 3000);
    }

    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
        // æ¿€æ´»å½“å‰é¡µé¢çš„å¯¼èˆªé“¾æ¥
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.navbar-nav .nav-link');

        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            }
        });

        // æ·»åŠ é¡µé¢åŠ è½½åŠ¨ç”»
        document.body.style.opacity = '0';
        document.body.style.transition = 'opacity 0.3s ease-in-out';

        setTimeout(() => {
            document.body.style.opacity = '1';
        }, 100);
    });
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
